<onefilellm_output>
<source type="local_folder" path=".">

<file path="DEPLOYMENT.md">
# Deployment Guide

## Current Limitations

The application currently uses **in-memory storage**, which means:
- ‚ùå Data is lost when the server restarts
- ‚ùå Data is not shared across multiple server instances
- ‚ùå Tournaments disappear after deployment restarts

## Recommended Deployment Options

### Option 1: Vercel (Recommended)

1. **Push to GitHub**
   ```bash
   git push origin main
   ```

2. **Deploy to Vercel**
   - Go to [vercel.com](https://vercel.com)
   - Import your GitHub repository
   - Vercel will auto-detect Next.js and configure build settings
   - Click "Deploy"

3. **Add Database (for persistence)**
   - Use Vercel Postgres, Vercel KV, or external database
   - Update `src/lib/database.ts` to use the database instead of in-memory Map

### Option 2: Netlify

1. **Push to GitHub**
   ```bash
   git push origin main
   ```

2. **Deploy to Netlify**
   - Go to [netlify.com](https://netlify.com)
   - Import your GitHub repository
   - Build command: `bun run build`
   - Publish directory: `.next`
   - Click "Deploy"

### Option 3: Self-Hosted with Docker

1. **Create Dockerfile**
   ```dockerfile
   FROM oven/bun:1 as base
   WORKDIR /app
   
   # Install dependencies
   COPY package.json bun.lock ./
   RUN bun install --frozen-lockfile
   
   # Copy source
   COPY . .
   
   # Build
   RUN bun run build
   
   # Expose port
   EXPOSE 3000
   
   # Start
   CMD ["bun", "start"]
   ```

2. **Build and Run**
   ```bash
   docker build -t blind-ranking .
   docker run -p 3000:3000 blind-ranking
   ```

## Making Data Persistent

To make tournaments persist, you need to replace the in-memory storage with a real database:

### Option A: Vercel KV (Redis)

```bash
bun add @vercel/kv
```

Update `src/lib/database.ts`:
```typescript
import { kv } from '@vercel/kv';

export async function createTournament(topic: string, items: any[]) {
  const id = generateId();
  const tournament = { id, topic, items, createdAt: new Date(), totalVotes: 0 };
  await kv.set(`tournament:${id}`, tournament);
  return tournament;
}

export async function getTournament(id: string) {
  return await kv.get(`tournament:${id}`);
}
```

### Option B: PostgreSQL with Prisma

```bash
bun add prisma @prisma/client
bunx prisma init
```

Create schema in `prisma/schema.prisma`:
```prisma
model Tournament {
  id         String   @id @default(cuid())
  topic      String
  items      Json
  createdAt  DateTime @default(now())
  totalVotes Int      @default(0)
}
```

### Option C: MongoDB

```bash
bun add mongodb
```

Update `src/lib/database.ts` to use MongoDB client.

## Environment Variables

For production deployments, set these environment variables:

```env
# Database (if using external DB)
DATABASE_URL=your_database_url

# Optional: Analytics
NEXT_PUBLIC_GA_ID=your_google_analytics_id

# Optional: Error tracking
SENTRY_DSN=your_sentry_dsn
```

## Performance Optimizations

1. **Enable Static Generation** where possible
2. **Add Image Optimization** for contender images
3. **Implement Caching** for leaderboard data
4. **Add Rate Limiting** to prevent abuse
5. **Use CDN** for static assets

## Security Considerations

1. **Add CORS protection** for API routes
2. **Implement rate limiting** on voting endpoints
3. **Add CAPTCHA** to prevent bot voting
4. **Sanitize user inputs** for topic and contender names
5. **Add authentication** for tournament management

## Monitoring

1. **Set up error tracking** (Sentry, LogRocket)
2. **Add analytics** (Google Analytics, Plausible)
3. **Monitor performance** (Vercel Analytics, New Relic)
4. **Track API usage** and rate limits

## Current Status

‚úÖ Application builds successfully
‚úÖ All routes are functional
‚úÖ TypeScript type-safe
‚úÖ ESLint passes
‚ùå No persistent storage (in-memory only)
‚ùå Not deployed to production
‚ùå No database configured

## Next Steps

1. Choose a deployment platform (Vercel recommended)
2. Add a database for persistence
3. Configure environment variables
4. Deploy and test
5. Set up monitoring and analytics

</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}

</file>

<file path="package.json">
{
  "name": "nextjs-template",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "react": "^19.2.1",
    "react-dom": "^19.2.1",
    "next": "15.5.9"
  },
  "devDependencies": {
    "typescript": "^5.9.3",
    "@types/node": "^24.10.2",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@tailwindcss/postcss": "^4.1.17",
    "tailwindcss": "^4.1.17",
    "eslint": "^9.39.1",
    "eslint-config-next": "^15.5.7",
    "@eslint/eslintrc": "^3.3.3"
  }
}

</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

</file>

<file path="src/lib/elo.ts">
import { VoteResult } from './types';

const K_FACTOR = 32; // Standard K-factor for dynamic ratings

/**
 * Calculate expected score for a player
 * @param playerRating Current ELO rating of the player
 * @param opponentRating Current ELO rating of the opponent
 * @returns Expected score (probability of winning) between 0 and 1
 */
function getExpectedScore(playerRating: number, opponentRating: number): number {
  return 1 / (1 + Math.pow(10, (opponentRating - playerRating) / 400));
}

/**
 * Calculate new ELO ratings after a match
 * @param winnerRating Current rating of the winner
 * @param loserRating Current rating of the loser
 * @returns New ratings for both winner and loser
 */
export function calculateEloChange(
  winnerRating: number,
  loserRating: number
): { winnerNewRating: number; loserNewRating: number } {
  const winnerExpected = getExpectedScore(winnerRating, loserRating);
  const loserExpected = getExpectedScore(loserRating, winnerRating);
  
  // Winner gets 1 point, loser gets 0 points
  const winnerNewRating = Math.round(winnerRating + K_FACTOR * (1 - winnerExpected));
  const loserNewRating = Math.round(loserRating + K_FACTOR * (0 - loserExpected));
  
  return { winnerNewRating, loserNewRating };
}

/**
 * Process a vote and return the result with updated scores
 * @param winnerId ID of the winning item
 * @param loserId ID of the losing item
 * @param winnerCurrentScore Current ELO score of winner
 * @param loserCurrentScore Current ELO score of loser
 * @returns Vote result with new scores
 */
export function processVote(
  winnerId: string,
  loserId: string,
  winnerCurrentScore: number,
  loserCurrentScore: number
): VoteResult {
  const { winnerNewRating, loserNewRating } = calculateEloChange(
    winnerCurrentScore,
    loserCurrentScore
  );
  
  return {
    winnerId,
    loserId,
    winnerNewScore: winnerNewRating,
    loserNewScore: loserNewRating,
  };
}

</file>

<file path="src/lib/storage.ts">
// Browser-side storage fallback for persistence
// This allows tournaments to persist in the browser's localStorage

import { Tournament } from './types';

const STORAGE_KEY = 'blind_ranking_tournaments';

export function saveTournamentToStorage(tournament: Tournament): void {
  if (typeof window === 'undefined') return;
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    const tournaments = stored ? JSON.parse(stored) : {};
    tournaments[tournament.id] = tournament;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(tournaments));
  } catch (error) {
    console.error('Failed to save tournament to storage:', error);
  }
}

export function getTournamentFromStorage(id: string): Tournament | null {
  if (typeof window === 'undefined') return null;
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) return null;
    
    const tournaments = JSON.parse(stored);
    return tournaments[id] || null;
  } catch (error) {
    console.error('Failed to get tournament from storage:', error);
    return null;
  }
}

export function updateTournamentInStorage(tournament: Tournament): void {
  if (typeof window === 'undefined') return;
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    const tournaments = stored ? JSON.parse(stored) : {};
    tournaments[tournament.id] = tournament;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(tournaments));
  } catch (error) {
    console.error('Failed to update tournament in storage:', error);
  }
}

export function getAllTournamentsFromStorage(): Tournament[] {
  if (typeof window === 'undefined') return [];
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) return [];
    
    const tournaments = JSON.parse(stored);
    return Object.values(tournaments);
  } catch (error) {
    console.error('Failed to get all tournaments from storage:', error);
    return [];
  }
}

</file>

<file path="src/lib/contenders.ts">
// Generate default contenders based on topic
export function generateDefaultContenders(topic: string): Array<{ id: string; name: string; imageUrl: string }> {
  const topicLower = topic.toLowerCase();
  
  // Office Snacks
  if (topicLower.includes('snack') || topicLower.includes('office')) {
    return [
      { id: '1', name: 'Chocolate Chip Cookies', imageUrl: 'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?w=400' },
      { id: '2', name: 'Potato Chips', imageUrl: 'https://images.unsplash.com/photo-1566478989037-eec170784d0b?w=400' },
      { id: '3', name: 'Granola Bars', imageUrl: 'https://images.unsplash.com/photo-1606312619070-d48b4cbc5b52?w=400' },
      { id: '4', name: 'Mixed Nuts', imageUrl: 'https://images.unsplash.com/photo-1599599810769-bcde5a160d32?w=400' },
      { id: '5', name: 'Fresh Fruit', imageUrl: 'https://images.unsplash.com/photo-1619566636858-adf3ef46400b?w=400' },
      { id: '6', name: 'Pretzels', imageUrl: 'https://images.unsplash.com/photo-1599490659213-e2b9527bd087?w=400' },
      { id: '7', name: 'Popcorn', imageUrl: 'https://images.unsplash.com/photo-1578849278619-e73505e9610f?w=400' },
      { id: '8', name: 'Trail Mix', imageUrl: 'https://images.unsplash.com/photo-1520967824495-b529aeba26df?w=400' },
      { id: '9', name: 'Protein Bars', imageUrl: 'https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?w=400' },
      { id: '10', name: 'Crackers & Cheese', imageUrl: 'https://images.unsplash.com/photo-1452195100486-9cc805987862?w=400' },
      { id: '11', name: 'Yogurt', imageUrl: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400' },
      { id: '12', name: 'Candy Bars', imageUrl: 'https://images.unsplash.com/photo-1582058091505-f87a2e55a40f?w=400' },
      { id: '13', name: 'Rice Cakes', imageUrl: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400' },
      { id: '14', name: 'Beef Jerky', imageUrl: 'https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=400' },
      { id: '15', name: 'Veggie Sticks', imageUrl: 'https://images.unsplash.com/photo-1566385101042-1a0aa0c1268c?w=400' },
      { id: '16', name: 'Cookies & Cream', imageUrl: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=400' },
    ];
  }
  
  // Movies
  if (topicLower.includes('movie') || topicLower.includes('film')) {
    return [
      { id: '1', name: 'The Shawshank Redemption', imageUrl: 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400' },
      { id: '2', name: 'The Godfather', imageUrl: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=400' },
      { id: '3', name: 'The Dark Knight', imageUrl: 'https://images.unsplash.com/photo-1509347528160-9a9e33742cdb?w=400' },
      { id: '4', name: 'Pulp Fiction', imageUrl: 'https://images.unsplash.com/photo-1594908900066-3f47337549d8?w=400' },
      { id: '5', name: 'Forrest Gump', imageUrl: 'https://images.unsplash.com/photo-1485846234645-a62644f84728?w=400' },
      { id: '6', name: 'Inception', imageUrl: 'https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=400' },
      { id: '7', name: 'The Matrix', imageUrl: 'https://images.unsplash.com/photo-1574267432644-f610a4ab5f6c?w=400' },
      { id: '8', name: 'Interstellar', imageUrl: 'https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=400' },
      { id: '9', name: 'Fight Club', imageUrl: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400' },
      { id: '10', name: 'Goodfellas', imageUrl: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400' },
      { id: '11', name: 'The Silence of the Lambs', imageUrl: 'https://images.unsplash.com/photo-1518676590629-3dcbd9c5a5c9?w=400' },
      { id: '12', name: 'Saving Private Ryan', imageUrl: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=400' },
      { id: '13', name: 'The Green Mile', imageUrl: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400' },
      { id: '14', name: 'Gladiator', imageUrl: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=400' },
      { id: '15', name: 'The Departed', imageUrl: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400' },
      { id: '16', name: 'The Prestige', imageUrl: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=400' },
    ];
  }
  
  // Generic fallback
  return Array.from({ length: 16 }, (_, i) => ({
    id: String(i + 1),
    name: `${topic} Option ${i + 1}`,
    imageUrl: `https://images.unsplash.com/photo-1557683316-973673baf926?w=400&q=80&auto=format&fit=crop&txt=${encodeURIComponent(topic + ' ' + (i + 1))}`,
  }));
}

</file>

<file path="src/lib/types.ts">
export interface Item {
  id: string;
  name: string;
  imageUrl: string;
  eloScore: number;
  wins: number;
  losses: number;
}

export interface Tournament {
  id: string;
  topic: string;
  items: Item[];
  createdAt: Date;
  totalVotes: number;
}

export interface VoteResult {
  winnerId: string;
  loserId: string;
  winnerNewScore: number;
  loserNewScore: number;
}

</file>

<file path="src/lib/database.ts">
import { Tournament, Item } from './types';

// In-memory database
const tournaments = new Map<string, Tournament>();

export function createTournament(topic: string, items: Omit<Item, 'eloScore' | 'wins' | 'losses'>[]): Tournament {
  const id = generateId();
  
  const tournament: Tournament = {
    id,
    topic,
    items: items.map(item => ({
      ...item,
      eloScore: 1500, // Standard starting ELO
      wins: 0,
      losses: 0,
    })),
    createdAt: new Date(),
    totalVotes: 0,
  };
  
  tournaments.set(id, tournament);
  return tournament;
}

export function getTournament(id: string): Tournament | undefined {
  return tournaments.get(id);
}

export function updateItemScores(
  tournamentId: string,
  winnerId: string,
  loserId: string,
  winnerNewScore: number,
  loserNewScore: number
): void {
  const tournament = tournaments.get(tournamentId);
  if (!tournament) return;
  
  const winnerItem = tournament.items.find(item => item.id === winnerId);
  const loserItem = tournament.items.find(item => item.id === loserId);
  
  if (winnerItem && loserItem) {
    winnerItem.eloScore = winnerNewScore;
    winnerItem.wins += 1;
    loserItem.eloScore = loserNewScore;
    loserItem.losses += 1;
    tournament.totalVotes += 1;
  }
}

export function getLeaderboard(tournamentId: string): Item[] {
  const tournament = tournaments.get(tournamentId);
  if (!tournament) return [];
  
  return [...tournament.items].sort((a, b) => b.eloScore - a.eloScore);
}

function generateId(): string {
  return Math.random().toString(36).substring(2, 9);
}

</file>

<file path="src/app/api/tournament/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { createTournament } from '@/lib/database';
import { generateDefaultContenders } from '@/lib/contenders';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { topic, items } = body;
    
    if (!topic || typeof topic !== 'string') {
      return NextResponse.json(
        { error: 'Topic is required' },
        { status: 400 }
      );
    }
    
    // Use provided items or generate defaults
    const contenders = items && items.length > 0 
      ? items 
      : generateDefaultContenders(topic);
    
    const tournament = createTournament(topic, contenders);
    
    return NextResponse.json({ 
      success: true, 
      tournamentId: tournament.id 
    });
  } catch (error) {
    console.error('Error creating tournament:', error);
    return NextResponse.json(
      { error: 'Failed to create tournament' },
      { status: 500 }
    );
  }
}

</file>

<file path="src/app/api/vote/route.ts">
import { NextRequest, NextResponse } from 'next/server';
import { getTournament, updateItemScores } from '@/lib/database';
import { processVote } from '@/lib/elo';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { tournamentId, winnerId, loserId } = body;
    
    if (!tournamentId || !winnerId || !loserId) {
      return NextResponse.json(
        { error: 'Missing required fields' },
        { status: 400 }
      );
    }
    
    const tournament = getTournament(tournamentId);
    if (!tournament) {
      return NextResponse.json(
        { error: 'Tournament not found' },
        { status: 404 }
      );
    }
    
    const winner = tournament.items.find(item => item.id === winnerId);
    const loser = tournament.items.find(item => item.id === loserId);
    
    if (!winner || !loser) {
      return NextResponse.json(
        { error: 'Invalid item IDs' },
        { status: 400 }
      );
    }
    
    const result = processVote(
      winnerId,
      loserId,
      winner.eloScore,
      loser.eloScore
    );
    
    updateItemScores(
      tournamentId,
      winnerId,
      loserId,
      result.winnerNewScore,
      result.loserNewScore
    );
    
    return NextResponse.json({ 
      success: true,
      result 
    });
  } catch (error) {
    console.error('Error processing vote:', error);
    return NextResponse.json(
      { error: 'Failed to process vote' },
      { status: 500 }
    );
  }
}

</file>

<file path="src/app/page.tsx">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { generateDefaultContenders } from '@/lib/contenders';
import { saveTournamentToStorage } from '@/lib/storage';

export default function Home() {
  const router = useRouter();
  const [topic, setTopic] = useState('');
  const [items, setItems] = useState<Array<{ id: string; name: string; imageUrl: string }>>([]);
  const [isGenerating, setIsGenerating] = useState(false);
  const [showItems, setShowItems] = useState(false);

  const handleGenerateItems = () => {
    if (!topic.trim()) return;
    const generated = generateDefaultContenders(topic);
    setItems(generated);
    setShowItems(true);
  };

  const handleCreateTournament = async () => {
    if (!topic.trim() || items.length === 0) return;
    
    setIsGenerating(true);
    try {
      const response = await fetch('/api/tournament', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ topic, items }),
      });
      
      const data = await response.json();
      if (data.success) {
        // Also save to localStorage for persistence
        const tournament = {
          id: data.tournamentId,
          topic,
          items: items.map(item => ({
            ...item,
            eloScore: 1500,
            wins: 0,
            losses: 0,
          })),
          createdAt: new Date(),
          totalVotes: 0,
        };
        saveTournamentToStorage(tournament);
        
        router.push(`/vote/${data.tournamentId}`);
      }
    } catch (error) {
      console.error('Error creating tournament:', error);
    } finally {
      setIsGenerating(false);
    }
  };

  const updateItem = (id: string, field: 'name' | 'imageUrl', value: string) => {
    setItems(items.map(item => 
      item.id === id ? { ...item, [field]: value } : item
    ));
  };

  return (
    <div className="min-h-screen bg-[var(--background)] text-[var(--foreground)] p-4 md:p-8">
      <div className="max-w-4xl mx-auto">
        <header className="text-center mb-12">
          <h1 className="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            Blind Ranking
          </h1>
          <p className="text-gray-400 text-lg">
            Create crowd-sourced rankings through ELO-based voting
          </p>
        </header>

        <div className="bg-[var(--card)] rounded-2xl p-6 md:p-8 shadow-2xl border border-[var(--border)]">
          <div className="mb-6">
            <label htmlFor="topic" className="block text-sm font-medium mb-2 text-gray-300">
              What would you like to rank?
            </label>
            <input
              id="topic"
              type="text"
              value={topic}
              onChange={(e) => setTopic(e.target.value)}
              placeholder="e.g., Best Office Snacks, Top Movies, Favorite Games..."
              className="w-full px-4 py-3 bg-[var(--background)] border border-[var(--border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-500"
              onKeyDown={(e) => e.key === 'Enter' && !showItems && handleGenerateItems()}
            />
          </div>

          {!showItems ? (
            <button
              onClick={handleGenerateItems}
              disabled={!topic.trim()}
              className="w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors duration-200"
            >
              Generate Contenders
            </button>
          ) : (
            <>
              <div className="mb-6">
                <h2 className="text-xl font-semibold mb-4">Edit Contenders ({items.length})</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto pr-2">
                  {items.map((item) => (
                    <div key={item.id} className="bg-[var(--background)] p-3 rounded-lg border border-[var(--border)]">
                      <input
                        type="text"
                        value={item.name}
                        onChange={(e) => updateItem(item.id, 'name', e.target.value)}
                        className="w-full px-2 py-1 mb-2 bg-[var(--card)] border border-[var(--border)] rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"
                      />
                      <input
                        type="text"
                        value={item.imageUrl}
                        onChange={(e) => updateItem(item.id, 'imageUrl', e.target.value)}
                        placeholder="Image URL"
                        className="w-full px-2 py-1 bg-[var(--card)] border border-[var(--border)] rounded text-xs focus:outline-none focus:ring-1 focus:ring-blue-500 text-gray-400"
                      />
                    </div>
                  ))}
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={() => setShowItems(false)}
                  className="flex-1 py-3 px-6 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-colors duration-200"
                >
                  Back
                </button>
                <button
                  onClick={handleCreateTournament}
                  disabled={isGenerating}
                  className="flex-1 py-3 px-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-700 disabled:to-gray-700 disabled:cursor-not-allowed rounded-lg font-semibold transition-all duration-200 shadow-lg"
                >
                  {isGenerating ? 'Creating...' : 'Create Tournament'}
                </button>
              </div>
            </>
          )}
        </div>

        <footer className="text-center mt-12 text-gray-500 text-sm">
          <p>Share the voting link with your community to start ranking!</p>
        </footer>
      </div>
    </div>
  );
}

</file>

<file path="src/app/results/[id]/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useParams, useRouter } from 'next/navigation';
import { Tournament, Item } from '@/lib/types';
import { getTournament } from '@/lib/database';
import { getTournamentFromStorage } from '@/lib/storage';

export default function ResultsPage() {
  const params = useParams();
  const router = useRouter();
  const tournamentId = params.id as string;
  
  const [tournament, setTournament] = useState<Tournament | null>(null);
  const [leaderboard, setLeaderboard] = useState<Item[]>([]);
  const [loading, setLoading] = useState(true);

  const loadResults = () => {
    // Try server-side first
    let data = getTournament(tournamentId);
    
    // Fallback to localStorage if server data not available
    if (!data) {
      const storedData = getTournamentFromStorage(tournamentId);
      if (storedData) {
        data = storedData;
      }
    }
    
    if (data) {
      setTournament(data);
      // Sort items by ELO score for leaderboard
      const sorted = [...data.items].sort((a, b) => b.eloScore - a.eloScore);
      setLeaderboard(sorted);
      setLoading(false);
    } else {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadResults();
    // Auto-refresh every 3 seconds for live updates
    const interval = setInterval(loadResults, 3000);
    return () => clearInterval(interval);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [tournamentId]);

  if (loading) {
    return (
      <div className="min-h-screen bg-[var(--background)] flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p className="text-gray-400">Loading results...</p>
        </div>
      </div>
    );
  }

  if (!tournament) {
    return (
      <div className="min-h-screen bg-[var(--background)] flex items-center justify-center p-4">
        <div className="text-center">
          <h1 className="text-3xl font-bold mb-4 text-red-400">Tournament Not Found</h1>
          <p className="text-gray-400 mb-6">This tournament doesn&apos;t exist or has been removed.</p>
          <button
            onClick={() => router.push('/')}
            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors"
          >
            Create New Tournament
          </button>
        </div>
      </div>
    );
  }

  const maxScore = leaderboard[0]?.eloScore || 1500;
  const minScore = leaderboard[leaderboard.length - 1]?.eloScore || 1500;
  const scoreRange = maxScore - minScore || 1;

  return (
    <div className="min-h-screen bg-[var(--background)] text-[var(--foreground)] p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <header className="mb-8">
          <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
            <div>
              <h1 className="text-3xl md:text-5xl font-bold mb-2">{tournament.topic}</h1>
              <p className="text-gray-400">Live Leaderboard</p>
            </div>
            <div className="flex gap-3">
              <button
                onClick={() => router.push(`/vote/${tournamentId}`)}
                className="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors"
              >
                Vote Now
              </button>
              <button
                onClick={() => router.push('/')}
                className="px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-colors"
              >
                New Tournament
              </button>
            </div>
          </div>
          
          {/* Stats */}
          <div className="flex gap-6 text-sm">
            <div>
              <span className="text-gray-400">Total Votes:</span>
              <span className="ml-2 font-semibold text-blue-400">{tournament.totalVotes}</span>
            </div>
            <div>
              <span className="text-gray-400">Contenders:</span>
              <span className="ml-2 font-semibold text-purple-400">{leaderboard.length}</span>
            </div>
          </div>
        </header>

        {/* Leaderboard */}
        <div className="space-y-3">
          {leaderboard.map((item, index) => {
            const barWidth = scoreRange > 0 
              ? ((item.eloScore - minScore) / scoreRange) * 100 
              : 100;
            const isTop3 = index < 3;
            
            return (
              <div
                key={item.id}
                className={`bg-[var(--card)] rounded-xl overflow-hidden border transition-all duration-300 hover:scale-[1.01] ${
                  isTop3 ? 'border-yellow-500/50' : 'border-[var(--border)]'
                }`}
              >
                <div className="flex items-center p-4 md:p-6 relative">
                  {/* Background bar */}
                  <div 
                    className="absolute left-0 top-0 bottom-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 transition-all duration-500"
                    style={{ width: `${barWidth}%` }}
                  ></div>
                  
                  {/* Content */}
                  <div className="relative z-10 flex items-center gap-4 md:gap-6 w-full">
                    {/* Rank */}
                    <div className={`text-2xl md:text-3xl font-bold w-12 md:w-16 text-center ${
                      index === 0 ? 'text-yellow-400' :
                      index === 1 ? 'text-gray-300' :
                      index === 2 ? 'text-orange-400' :
                      'text-gray-500'
                    }`}>
                      {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                    </div>
                    
                    {/* Image */}
                    <div className="w-16 h-16 md:w-20 md:h-20 rounded-lg overflow-hidden flex-shrink-0 border-2 border-[var(--border)]">
                      {/* eslint-disable-next-line @next/next/no-img-element */}
                      <img
                        src={item.imageUrl}
                        alt={item.name}
                        className="w-full h-full object-cover"
                      />
                    </div>
                    
                    {/* Info */}
                    <div className="flex-1 min-w-0">
                      <h3 className="text-lg md:text-xl font-semibold truncate">{item.name}</h3>
                      <div className="flex gap-4 text-sm text-gray-400 mt-1">
                        <span>ELO: <span className="text-blue-400 font-semibold">{item.eloScore}</span></span>
                        <span>W: <span className="text-green-400">{item.wins}</span></span>
                        <span>L: <span className="text-red-400">{item.losses}</span></span>
                      </div>
                    </div>
                    
                    {/* Win Rate */}
                    <div className="hidden md:block text-right">
                      <div className="text-2xl font-bold">
                        {item.wins + item.losses > 0 
                          ? `${Math.round((item.wins / (item.wins + item.losses)) * 100)}%`
                          : '‚Äî'}
                      </div>
                      <div className="text-xs text-gray-400">Win Rate</div>
                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>

        {/* Share Section */}
        <div className="mt-12 bg-[var(--card)] rounded-xl p-6 border border-[var(--border)] text-center">
          <h3 className="text-xl font-semibold mb-3">Share This Tournament</h3>
          <p className="text-gray-400 mb-4">Get more votes by sharing the voting link:</p>
          <div className="flex gap-2 max-w-2xl mx-auto">
            <input
              type="text"
              readOnly
              value={`${typeof window !== 'undefined' ? window.location.origin : ''}/vote/${tournamentId}`}
              className="flex-1 px-4 py-2 bg-[var(--background)] border border-[var(--border)] rounded-lg text-sm"
              onClick={(e) => e.currentTarget.select()}
            />
            <button
              onClick={() => {
                navigator.clipboard.writeText(`${window.location.origin}/vote/${tournamentId}`);
              }}
              className="px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors"
            >
              Copy
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

</file>

<file path="src/app/vote/[id]/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useParams, useRouter } from 'next/navigation';
import { Tournament, Item } from '@/lib/types';
import { getTournament } from '@/lib/database';
import { getTournamentFromStorage, updateTournamentInStorage } from '@/lib/storage';

export default function VotePage() {
  const params = useParams();
  const router = useRouter();
  const tournamentId = params.id as string;
  
  const [tournament, setTournament] = useState<Tournament | null>(null);
  const [currentPair, setCurrentPair] = useState<[Item, Item] | null>(null);
  const [voteCount, setVoteCount] = useState(0);
  const [isVoting, setIsVoting] = useState(false);
  const [loading, setLoading] = useState(true);

  const loadTournament = () => {
    // Try server-side first
    let data = getTournament(tournamentId);
    
    // Fallback to localStorage if server data not available
    if (!data) {
      const storedData = getTournamentFromStorage(tournamentId);
      if (storedData) {
        data = storedData;
      }
    }
    
    if (data) {
      setTournament(data);
      setCurrentPair(getRandomPair(data.items));
      setLoading(false);
    } else {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadTournament();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [tournamentId]);

  const getRandomPair = (items: Item[]): [Item, Item] | null => {
    if (items.length < 2) return null;
    const shuffled = [...items].sort(() => Math.random() - 0.5);
    return [shuffled[0], shuffled[1]];
  };

  const handleVote = async (winnerId: string, loserId: string) => {
    if (isVoting || !tournament) return;
    
    setIsVoting(true);
    try {
      const response = await fetch('/api/vote', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ tournamentId, winnerId, loserId }),
      });
      
      if (response.ok) {
        const data = await response.json();
        
        // Update localStorage with new scores
        const updatedTournament = { ...tournament };
        const winnerItem = updatedTournament.items.find(item => item.id === winnerId);
        const loserItem = updatedTournament.items.find(item => item.id === loserId);
        
        if (winnerItem && loserItem && data.result) {
          winnerItem.eloScore = data.result.winnerNewScore;
          winnerItem.wins += 1;
          loserItem.eloScore = data.result.loserNewScore;
          loserItem.losses += 1;
          updatedTournament.totalVotes += 1;
          updateTournamentInStorage(updatedTournament);
        }
        
        setVoteCount(prev => prev + 1);
        // Reload tournament data and get new pair
        loadTournament();
      }
    } catch (error) {
      console.error('Error voting:', error);
    } finally {
      setIsVoting(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-[var(--background)] flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p className="text-gray-400">Loading tournament...</p>
        </div>
      </div>
    );
  }

  if (!tournament || !currentPair) {
    return (
      <div className="min-h-screen bg-[var(--background)] flex items-center justify-center p-4">
        <div className="text-center">
          <h1 className="text-3xl font-bold mb-4 text-red-400">Tournament Not Found</h1>
          <p className="text-gray-400 mb-6">This tournament doesn&apos;t exist or has been removed.</p>
          <button
            onClick={() => router.push('/')}
            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors"
          >
            Create New Tournament
          </button>
        </div>
      </div>
    );
  }

  const [itemA, itemB] = currentPair;

  return (
    <div className="min-h-screen bg-[var(--background)] text-[var(--foreground)] flex flex-col">
      {/* Header */}
      <header className="p-4 md:p-6 border-b border-[var(--border)]">
        <div className="max-w-7xl mx-auto flex justify-between items-center">
          <div>
            <h1 className="text-2xl md:text-3xl font-bold">{tournament.topic}</h1>
            <p className="text-sm text-gray-400 mt-1">Choose your favorite</p>
          </div>
          <button
            onClick={() => router.push(`/results/${tournamentId}`)}
            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors text-sm md:text-base"
          >
            See Results
          </button>
        </div>
      </header>

      {/* Arena */}
      <div className="flex-1 flex flex-col md:flex-row items-stretch">
        {/* Item A */}
        <button
          onClick={() => handleVote(itemA.id, itemB.id)}
          disabled={isVoting}
          className="flex-1 relative group overflow-hidden transition-all duration-300 hover:scale-[1.02] disabled:hover:scale-100 disabled:cursor-wait"
        >
          <div className="absolute inset-0 bg-gradient-to-br from-blue-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div 
            className="h-full min-h-[50vh] md:min-h-screen bg-cover bg-center relative"
            style={{ backgroundImage: `url(${itemA.imageUrl})` }}
          >
            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
            <div className="absolute bottom-0 left-0 right-0 p-6 md:p-8">
              <h2 className="text-3xl md:text-5xl font-bold mb-2 drop-shadow-lg">{itemA.name}</h2>
              <p className="text-sm md:text-base text-gray-300">Click to vote</p>
            </div>
          </div>
        </button>

        {/* VS Divider */}
        <div className="flex items-center justify-center bg-[var(--card)] md:w-20 py-4 md:py-0">
          <div className="text-2xl md:text-4xl font-bold text-gray-500 rotate-0 md:rotate-90">VS</div>
        </div>

        {/* Item B */}
        <button
          onClick={() => handleVote(itemB.id, itemA.id)}
          disabled={isVoting}
          className="flex-1 relative group overflow-hidden transition-all duration-300 hover:scale-[1.02] disabled:hover:scale-100 disabled:cursor-wait"
        >
          <div className="absolute inset-0 bg-gradient-to-br from-purple-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div 
            className="h-full min-h-[50vh] md:min-h-screen bg-cover bg-center relative"
            style={{ backgroundImage: `url(${itemB.imageUrl})` }}
          >
            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
            <div className="absolute bottom-0 left-0 right-0 p-6 md:p-8">
              <h2 className="text-3xl md:text-5xl font-bold mb-2 drop-shadow-lg">{itemB.name}</h2>
              <p className="text-sm md:text-base text-gray-300">Click to vote</p>
            </div>
          </div>
        </button>
      </div>

      {/* Progress Bar */}
      <div className="bg-[var(--card)] border-t border-[var(--border)] p-4">
        <div className="max-w-7xl mx-auto">
          <div className="flex justify-between items-center mb-2">
            <span className="text-sm text-gray-400">Your votes</span>
            <span className="text-sm font-semibold text-blue-400">{voteCount}</span>
          </div>
          <div className="w-full bg-[var(--background)] rounded-full h-2 overflow-hidden">
            <div 
              className="bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all duration-500 ease-out"
              style={{ width: `${Math.min((voteCount / 20) * 100, 100)}%` }}
            ></div>
          </div>
        </div>
      </div>
    </div>
  );
}

</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Next.js Template",
  description: "A minimal Next.js starter template",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
</file>

<file path="CONTEXT.md">
# Blind Ranking - ELO Tournament Application

## Project Overview
A Next.js web application that enables crowd-sourced rankings through ELO-based voting tournaments. Users can create tournaments on any topic, share voting links, and view live leaderboards.

## Purpose
Enable communities to democratically rank items (snacks, movies, products, etc.) through head-to-head comparisons using the proven ELO rating system.

## Key Features

### 1. Creator View (Home Page)
- Topic input for tournament creation
- Auto-generation of 16 default contenders
- Manual editing of contender list (name + image URL)
- Tournament generation with unique shareable URLs

### 2. Voting View (Arena)
- Split-screen comparison interface (Item A vs Item B)
- ELO-based score updates on each vote
- Continuous voting loop with random pairings
- Progress tracking for user engagement

### 3. Results View (Leaderboard)
- Live ranking display sorted by ELO score
- Visual representation with bar charts
- Movement indicators (up/down arrows)

## Technical Stack
- **Framework**: Next.js 15 (App Router)
- **React**: 19.1.0
- **Styling**: Tailwind CSS v4
- **TypeScript**: Full type safety
- **Package Manager**: Bun
- **Database**: In-memory storage (can be upgraded to persistent DB)

## Architecture Decisions

### Data Storage
Using in-memory storage for simplicity in sandboxed environment. Structure:
- Tournaments: Map of tournament ID to tournament data
- Items: Each tournament contains items with ELO scores
- Initial ELO score: 1500 (standard starting point)

### ELO Algorithm
- K-factor: 32 (standard for dynamic ratings)
- Expected score formula: 1 / (1 + 10^((opponentRating - playerRating) / 400))
- New rating: currentRating + K * (actualScore - expectedScore)

### Routing Structure
- `/` - Creator view (home page)
- `/vote/[id]` - Voting arena for specific tournament
- `/results/[id]` - Leaderboard for specific tournament

## Design Principles
- **Dark Mode First**: High contrast, modern aesthetic
- **Mobile Responsive**: Vertical stacking on mobile, side-by-side on desktop
- **Progressive Enhancement**: Works without JavaScript for basic functionality
- **Accessibility**: Semantic HTML, keyboard navigation support

## Project Conventions
- Server Components by default
- Client Components only when interactivity needed (marked with "use client")
- API routes in `src/app/api/` for data mutations
- Utilities in `src/lib/` for shared logic
- Components in `src/components/` for reusability

## Future Enhancements
- Persistent database (PostgreSQL/MongoDB)
- User authentication
- Tournament history and analytics
- Social sharing features
- Custom ELO parameters per tournament

</file>

<file path="README.md">
# Blind Ranking - ELO Tournament Application

A Next.js web application that enables crowd-sourced rankings through ELO-based voting tournaments. Create tournaments on any topic, share voting links, and view live leaderboards.

## Features

### üéØ Creator View
- Enter any topic to create a tournament
- Auto-generate 16 default contenders based on the topic
- Edit contender names and image URLs
- Generate unique shareable tournament URLs

### ‚öîÔ∏è Voting Arena
- Split-screen comparison interface
- Click to vote for your favorite
- Real-time ELO score updates
- Progress tracking
- Continuous voting loop with random pairings

### üèÜ Live Leaderboard
- Real-time ranking updates
- Visual bar charts showing relative scores
- Win/loss statistics
- Win rate percentages
- Medal indicators for top 3
- Auto-refresh every 3 seconds

## Tech Stack

- **Framework**: Next.js 15 (App Router)
- **React**: 19.1.0
- **Styling**: Tailwind CSS v4 (Dark Mode)
- **TypeScript**: Full type safety
- **Package Manager**: Bun
- **ELO Algorithm**: K-factor 32 for dynamic ratings

## Getting Started

### Installation

```bash
# Install dependencies
bun install
```

### Development

**Note**: This is a sandboxed environment. Do not run `next dev` or `bun dev`.

### Build

```bash
# Build the production application
bun build
```

### Linting

```bash
# Run ESLint
bun lint
```

## How It Works

### ELO Rating System

The application uses the ELO rating system (commonly used in chess) to rank items:

1. **Initial Score**: All items start with 1500 ELO points
2. **Expected Score**: Calculated based on rating difference between two items
3. **Score Update**: Winner gains points, loser loses points based on expected outcome
4. **K-Factor**: Set to 32 for dynamic, responsive ratings

### User Flow

1. **Create Tournament**
   - Enter a topic (e.g., "Best Office Snacks")
   - Review/edit the 16 generated contenders
   - Click "Create Tournament" to get a shareable URL

2. **Vote**
   - Visit the tournament URL
   - Choose between two randomly selected items
   - Vote as many times as you want
   - Watch your progress bar fill up

3. **View Results**
   - Click "See Results" from the voting page
   - View live rankings sorted by ELO score
   - Share the voting link to get more participants

## Project Structure

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tournament/route.ts  # Create tournament endpoint
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vote/route.ts        # Process vote endpoint
‚îÇ   ‚îú‚îÄ‚îÄ vote/[id]/page.tsx       # Voting arena
‚îÇ   ‚îú‚îÄ‚îÄ results/[id]/page.tsx    # Leaderboard
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Home/Creator view
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # Root layout
‚îÇ   ‚îî‚îÄ‚îÄ globals.css              # Global styles
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                 # TypeScript interfaces
‚îÇ   ‚îú‚îÄ‚îÄ database.ts              # In-memory data storage
‚îÇ   ‚îú‚îÄ‚îÄ elo.ts                   # ELO algorithm
‚îÇ   ‚îî‚îÄ‚îÄ contenders.ts            # Default contender generator
‚îî‚îÄ‚îÄ components/                  # Reusable components (future)
```

## Design Principles

- **Dark Mode First**: High contrast, modern aesthetic
- **Mobile Responsive**: Vertical stacking on mobile, side-by-side on desktop
- **Progressive Enhancement**: Works without JavaScript for basic functionality
- **Accessibility**: Semantic HTML, keyboard navigation support

## Future Enhancements

- [ ] Persistent database (PostgreSQL/MongoDB)
- [ ] User authentication
- [ ] Tournament history and analytics
- [ ] Social sharing features
- [ ] Custom ELO parameters per tournament
- [ ] Image upload functionality
- [ ] Tournament categories and discovery
- [ ] Export results as images/PDFs

## Contributing

This project follows Next.js best practices:
- Server Components by default
- Client Components only when needed (marked with "use client")
- API routes for data mutations
- Utilities in `src/lib/` for shared logic

## License

MIT

---

Built with ‚ù§Ô∏è using Next.js 15 and Tailwind CSS v4

</file>

</source>
</onefilellm_output>